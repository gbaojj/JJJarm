local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

game:GetService("ReplicatedStorage").Packages.Knit.Services.WrestleService.RF.OnAutoFight:InvokeServer()

local Window = Fluent:CreateWindow({
    Title = "Arm ",
    SubTitle = "by gbao",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true, 
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl })

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options

-- ...rest of existing code...
local NPCSection = Tabs.Main:AddSection("Auto NPC Farm")
local VirtualInputManager = game:GetService("VirtualInputManager")
local npcFolderPath = workspace.GameObjects.RngNPCs.BlossomVillage.Npc
local isAutoFarming = false

-- Hàm kiểm tra và in lỗi nếu NPC không đúng cấu trúc
local function validateNPC(npc)
    if not npc:IsA("Model") then
        return false, "Không phải Model."
    end

    if not npc:FindFirstChild("ProximityPrompt") then
        return false, "Không có ProximityPrompt."
    end

    return true
end

-- Hàm di chuyển tới NPC
local function moveToNPC(npc)
    local humanoidRootPart = game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then
        warn("Không tìm thấy HumanoidRootPart.")
        return false
    end

    local targetPosition = npc.PrimaryPart and npc.PrimaryPart.Position or npc:GetBoundingBox().Position
    humanoidRootPart.CFrame = CFrame.new(targetPosition)
    return true
end

-- Hàm mô phỏng nhấn phím
local function simulateKeyPress()
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
    task.wait(0.5)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end

-- Toggle Auto Beat NPC
local AutoBeatNPCToggle = Tabs.Main:AddToggle("AutoBeatNPC", {
    Title = "Auto Beat NPC",
    Description = "Auto interact with NPCs in Blossom Village.",
    Default = false
})

AutoBeatNPCToggle:OnChanged(function()
    isAutoFarming = AutoBeatNPCToggle.Value

    if isAutoFarming then
        print("Auto Beat NPC started.")

        spawn(function()
            while isAutoFarming do
                for _, npc in ipairs(npcFolderPath:GetChildren()) do
                    if not isAutoFarming then break end

                    local isValid, errorMessage = validateNPC(npc)
                    if not isValid then
                        warn("NPC không hợp lệ:", npc.Name, "-", errorMessage)
                        continue
                    end

                    if moveToNPC(npc) then
                        task.wait(1)

                        local prompt = npc:FindFirstChild("ProximityPrompt")
                        if prompt and prompt.Enabled then
                            simulateKeyPress()
                            task.wait(1.5) -- Thời gian chờ giữa các lần tấn công
                        else
                            warn("ProximityPrompt không khả dụng tại NPC:", npc.Name)
                        end
                    end
                end
                task.wait(2) -- Thời gian chờ giữa các vòng lặp
            end
        end)
    else
        print("Auto Beat NPC stopped.")
    end
end)



local OtherSection = Tabs.Main:AddSection("Scripts")
    OtherSection:AddButton({
        Title = "Anti AFK",
        Callback = function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/batusz/main/roblox/__Anti__Afk__Script__", true))()
    end
})



  

-- Addons:
-- SaveManager (Allows you to have a configuration system)
-- InterfaceManager (Allows you to have a interface managment system)

-- Hand the library over to our managers
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)

-- Ignore keys that are used by ThemeManager.
-- (we dont want configs to save themes, do we?)
SaveManager:IgnoreThemeSettings()

-- You can add indexes of elements the save manager should ignore
SaveManager:SetIgnoreIndexes({})

-- use case for doing it this way:
-- a script hub could have themes in a global folder
-- and game configs in a separate folder per game
InterfaceManager:SetFolder("FluentScriptHub")
SaveManager:SetFolder("FluentScriptHub/specific-game")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)


Window:SelectTab(1)

Fluent:Notify({
    Title = "Fluent",
    Content = "The script has been loaded.",
    Duration = 8
})

-- You can use the SaveManager:LoadAutoloadConfig() to load a config
-- which has been marked to be one that auto loads!
SaveManager:LoadAutoloadConfig()
